var Game,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Game=function(superClass){extend(Game,superClass);function Game(){return Game.__super__.constructor.apply(this,arguments)}Game.prototype.w=window.innerWidth;Game.prototype.h=window.innerHeight;Game.prototype.bg="#3F7CB6";Game.prototype.assets={sprites:"sprites.atlas",sounds:{failure:"failure.ogg",success:"success.ogg"}};Game.prototype.plugins=[Fz2D.Plugins.GitHub,Fz2D.Plugins.Stats,Fz2D.Plugins.GoogleAnalytics];Game.prototype.ga={id:"UA-3042007-2"};Game.prototype.github={username:"icebreaker",repository:"menhir"};Game.prototype.sound={volume:50};Game.prototype.onload=function(game){var _,arrow,arrow_selected,assets,button,checkbox,cx,cy,i,j,k,l,menhir_texture,menhir_tile,mouse,random,scene,selected,selected_tile,sound,sounds,sprites,textures,tile,tiles,timeout,v,volume,x,y;assets=game.assets;sounds=assets.sounds;scene=game.scene;sprites=assets.sprites;volume=game.storage.get("volume",game.sound.volume);for(_ in sounds){sound=sounds[_];sound.setVolume(volume)}cx=game.w-3*68>>1;cy=game.h-9*68>>1;textures=[];for(i=j=0;j<=24;i=++j){textures.push(sprites.getTexture("building"+i))}menhir_texture=sprites.getTexture("menhir");random=new Fz2D.Random;tiles=scene.add(new Fz2D.Group(0,0,game.w,game.h));for(y=k=0;k<=7;y=++k){for(x=l=0;l<=7;x=++l){v=Fz2D.Iso.to(x*68,y*68);tile=tiles.add(new Fz2D.Entity(textures[random.next(textures.length)],cx+v.x,cy+v.y,"building"));tile.addAnimation("menhir",menhir_texture);tile.bounds.set(38,16,61,59);tile.xx=x;tile.yy=y}}menhir_tile=tiles.at(random.next(8)+(random.next(8)<<3));menhir_tile.play("menhir");selected=null;selected_tile=tiles.find(function(tile){return Fz2D.distSqr(menhir_tile,tile)===23120});arrow=scene.add(new Fz2D.Entity(sprites.getTexture("arrow_down"),menhir_tile.x+18,menhir_tile.y-68));arrow.kill();arrow_selected=scene.add(new Fz2D.Entity(sprites.getTexture("arrow_down"),selected_tile.x+18,selected_tile.y-68));timeout=scene.add(new Fz2D.Timeout(2e3,true));timeout.onend=function(){if(arrow_selected.exists){arrow_selected.kill();arrow.reset();return timeout.reset()}else{timeout.loop=false;return arrow.kill()}};timeout.reset();checkbox=scene.add(new Fz2D.Gui.Checkbox(20,20,sprites.getTexture("audio_on"),sprites.getTexture("audio_off")));checkbox.onclick=function(){var results;if(game.storage.get("volume",game.sound.volume)===0){volume=game.sound.volume}else{volume=0}game.storage.set("volume",volume);results=[];for(_ in sounds){sound=sounds[_];results.push(sound.setVolume(volume).stop())}return results};if(volume===0){checkbox.play("unchecked")}button=scene.add(new Fz2D.Gui.Button(120,20,sprites.getTexture("restart")));button.onclick=function(){if(selected!=null){selected.alpha=1}selected=null;tiles.each(function(tile){tile.addAnimation("building",textures[random.next(textures.length)]);return tile.play("building")});return tiles.at(random.next(8)+(random.next(8)<<3)).play("menhir")};game.input.mouse.hide();mouse=scene.add(new Fz2D.Gui.Mouse(sprites.getTexture("cursor_hand")));return mouse.onclick=function(){var between_tile,xx,yy;tile=tiles.find(Fz2D.contains,mouse.position);if(tile==null){if(selected!=null){selected.alpha=1}selected=null;return}if(selected!=null){x=tile.xx-selected.xx;y=tile.yy-selected.yy;if(tile.is("menhir")&&(Math.abs(x)^Math.abs(y))===2){xx=selected.xx+(x>>1);yy=selected.yy+(y>>1);between_tile=tiles.at(xx+yy*8);if(between_tile.is("building")){between_tile.play("menhir");selected.play("menhir");tile.play("building");assets.sounds.success.play()}else{assets.sounds.failure.play()}}else{assets.sounds.failure.play()}selected.alpha=1;return selected=null}else if(tile.is("building")){selected=tile;return selected.alpha=.7}}};return Game}(Fz2D.Game);Game.run();